# PIPELINES

## 1.TiÃªu chuáº©n há»‡ thá»‘ng `stdin`,`stdout` vÃ  `stderr`

Trong Unix, khi chÆ°Æ¡ng trÃ¬nh muá»‘n má»Ÿ má»™t file Ä‘á»ƒ Ä‘á»c hoáº·c ghi. NÃ³ báº¯t buá»™c pháº£i Ä‘áº¡t Ä‘Æ°á»£c **"file descriptor"** tá»« há»‡ Ä‘iá»u hÃ nh. Há»‡ Ä‘iá»u hÃ nh theo dÃµi file Ä‘Ã³.

Má»i quÃ¡ trÃ¬nh sáº½ tá»± Ä‘á»™ng giÃ£i mÃ£ 3 file descriptor máº·c Ä‘á»‹nh gá»i lÃ  **`stdin`** (standard input),**`stdout`** (standard output) vÃ  **`stderr`** (standard error). Ba file descriptor Ä‘Ã³ gá»i lÃ  chung lÃ  **"standard steams"**.

Má»™t Pipeline lÃ  má»™t táº­p há»£p cÃ¡c [tiáº¿n trÃ¬nh Ä‘Æ°á»£c](https://vi.wikipedia.org/wiki/Ti%E1%BA%BFn_tr%C3%ACnh "Tiáº¿n trÃ¬nh") ná»‘i vá»›i nhau bá»Ÿi cÃ¡c luá»“ng tiÃªu chuáº©n cá»§a chÃºng, sao cho vÄƒn báº£n Ä‘áº§u ra cá»§a má»—i tiáº¿n trÃ¬nh **`stdout`** Ä‘Æ°á»£c truyá»n trá»±c tiáº¿p dÆ°á»›i dáº¡ng Ä‘áº§u vÃ o **`stdin`** tá»›i tiáº¿n trÃ¬nh káº¿ tiáº¿p

Nhá»¯ng thá»© khÃ³ hiá»ƒu trÃªn nÃ³i cho nÃ³ dá»… hiá»ƒu lÃ : **`stdin`** lÃ  nhá»¯ng thá»© gÃ¬ nháº­p vÃ o chÆ°Æ¡ng trÃ¬nh, cÃ²n **`stdout`** lÃ  nhá»¯ng thá»© xuáº¥t ra mÃ n hÃ¬nh.

---

## 2. Nhá»¯ng Ä‘iá»u cÆ¡ báº£n cá»§a Pipe Operator

Trong Unix, má»i quÃ¡ trÃ¬nh Ä‘á»u cÃ³ ba luá»“ng tiÃªu chuáº©n: **`stdin`**,**`stdout`**, vÃ  **`stderr`**. Bá»Ÿi máº·c Ä‘á»‹nh báº¥t ká»³ quÃ¡ trÃ¬nh ghi **`stdout`** sáº½ xuáº¥t hiá»‡n dÆ°á»›i dáº¡ng vÄƒn báº£n **console**.

Tuy nhiÃªn, chÃºng ta cÃ³ thá»ƒ lÃ m cho nÃ³ Ä‘á»ƒ má»™t quÃ¡ trÃ¬nh **`stdout`** Ä‘Æ°á»£c Ä‘Ã­nh kÃ¨m má»™t quÃ¡ trÃ¬nh **`stdin`** Ä‘á»ƒ sáº£n xuáº¥t ra **"pipeline"**.

Äá»ƒ lÃ m Ä‘iá»u Ä‘Ã³, chÃºng ta sá»­ dá»¥ng dáº¥u **`|`** (kÃ½ tá»± pipeline hay cÃ²n gá»i lÃ  Ä‘Æ°á»ng á»‘ng). NhÃ¬n vÃ­ dá»¥ sau Ä‘Ã¢y:

```shell
$ ps ax | grep mysql
2922 ?       S      0:00
     /bin/sh /usr/bin/mysqld_safe
3164 ?       SL   204:21
     /usr/sbin/mysqld
$
```

Lá»‡nh **`px ax`** ghi má»™t danh sÃ¡ch cÃ¡c tiáº¿n trÃ¬nh hiá»‡n Ä‘ang cháº¡y Ä‘áº¿n **`stdout`**. Lá»‡nh **`grep mysql`** Ä‘á»c tá»« **`stdin`** vÃ  ghi táº¥t cáº£ nhá»¯ng dÃ²ng nháº­p chá»©a **"mysql"** Ä‘áº¿n **`stdout`**.

CÃ¹ng vá»›i nÃ³, chÃºng ta cÃ³ thá»ƒ nháº­n "pipeline" duy nháº¥t liá»‡t kÃª cÃ¡c tiáº¿n trÃ¬nh hiá»‡n Ä‘ang cháº¡y vá»›i tÃªn chá»©a **"mysql"**.Äiá»u quan trá»ng lÃ  **`ps`** vÃ  **`grep`** cáº£ 2 liÃªn quan vá»›i nhau trong quÃ¡ trÃ¬nh **`stdin`** vÃ  **`stdout`**. Há»‡ Ä‘iá»u hÃ nh gá»™p 2 quÃ¡ trÃ¬nh nÃ y láº¡i vá»›i nhau báº±ng dáº¥u **`|`**.

---

## 3. Nháº­p vÃ  xuáº¥t vá»›i dáº¥u chuyá»ƒn hÆ°á»›ng  `<` vÃ  `>`

Dáº¥u **`|`** cho phÃ©p gá»™p **`stdout`** cá»§a má»™t tiáº¿n trÃ¬nh Ä‘áº¿n **`stdin`** cá»§a má»™t tiáº¿n trÃ¬nh khÃ¡c. Tuy nhiÃªn, nÃ³ cÅ©ng cÃ³ thá»ƒ lÃ m **`stdout`** trá» trá»±c tiáº¿p Ä‘áº¿n tá»‡p, nÃªn lÃ  má»i thá»© Ä‘Æ°á»£c ghi vÃ o **`stdout`** thá»±c cháº¥t Ä‘Ã£ Ä‘Æ°á»£c gá»i vÃ o file. ChÃºng ta cÃ³ thá»ƒ dÃ¹ng tÆ°Æ¡ng tá»± nhÆ° tháº¿ cho **`stdin`**, nÃªn nhá»¯ng ná»™i dung cá»§a files Ä‘Æ°á»£c Ä‘á»c tá»± Ä‘á»™ng nhÆ° Ä‘áº§u vÃ o.

Äá»ƒ lÃ m Ä‘iá»u nÃ y báº¡n sá»­ dá»¥ng dáº¥u chuyá»ƒn hÆ°á»›ng **`<`** vÃ  **`>`**.

Muá»‘n nháº­p vÃ  vÃ o má»™t file, ta sá»­ dá»¥ng nhÆ° sau:

```shell
$ ps aux > ps_output.txt
```

NÃ³ sáº½ ghi output cá»§a **`ps aux`** Ä‘áº¿n file **`ps_output.txt`** trÃªn directory hiá»‡n táº¡i (trong khi Ä‘Ã³ thÃ´ng thÆ°á»ng nÃ³ sáº½ xuáº¥t ra mÃ n hÃ¬nh). Lá»‡nh **`ps`** chÃ­nh nÃ³ khÃ´ng biáº¿t ráº±ng nÃ³ thá»±c cháº¥t Ä‘ang ghi trÃªn file. BÃªn trong nÃ³ Ä‘Æ¡n giáº£n lÃ  "stardard output".

Náº¿u muá»‘n xuáº¥t ra má»™t file, sá»­ dá»¥ng dáº¥u **`<`** nhÆ° sau:

```shell
$ sort < words.txt
```

á» Ä‘Ã¢y, Lá»‡nh **`sort`** sáº½ Ä‘á»c **`stdin`** trÆ°á»›c khi nÃ³ xem Ä‘áº¿n cuá»‘i cÃ¹ng cá»§a file Ä‘Ã¡nh dáº¥u vÃ  sáº¯p xáº¿p cÃ¡c dÃ²ng theo chá»¯ cÃ¡i, ghi láº¡i nhá»¯ng sáº¯p xáº¿p Ä‘Ã³ xuáº¥t ra **`stdout`**.

Dáº¥u **`>`** phá»• biáº¿n hÆ¡n nhiá»u so vá»›i dáº¥u **`<`** bá»Ÿi vÃ¬ cÃ³ ráº¥t nhiá»u chÆ°Æ¡ng trÃ¬nh cÃ³ thá»ƒ há»— trá»£ trá»±c tiáº¿p 1 file Ä‘áº§u vÃ o lÃ m Ä‘á»‘i sá»‘. 

**VÃ­ dá»¥:** `sort words.txt` sáº½ hoáº¡t Ä‘á»™ng cÅ©ng nhÆ° `sort < words.txt`. Tuy nhiÃªn náº¿u chá»‰ cÃ³ **`sort`** nÃ³ sáº½ há»— trá»£ Ä‘á»c tá»« **`stdin`**, ta cÃ³ thá»ƒ sá»­ dá»¥ng dáº¥u **`<`** Ä‘á»ƒ Ä‘á»c file.

### Váº¥n Ä‘á» vá»›i **`cat file |...`**

```shell
$ cat some_file.txt | some_command
```

**`some_file.txt`** thÃ¬ báº¡n cÃ³ thá»ƒ add báº¥t ká»³ file nÃ o cÃ²n **`some_command`** thÃ¬ báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng báº¥t ká»³ tiáº¿n trÃ¬nh nÃ o. Lá»‡nh **`cat`** sáº½ ghi nhá»¯ng ná»™i dung tá»« **`some_file.txt`** Ä‘áº¿n **`stdout`** trong khi dáº¥u **`|`** sáº½ dÃ¡n **`some_command`** vÃ o **`stdin`**.

Sá»­ dá»¥ng **`cat`** vÃ  **`|`** lÃ  dÆ° thá»«a trong khi chá»‰ cáº§n sá»­ dá»¥ng dáº¥u **`<`** nhÆ° sau:

```shell
$ some_command < some_file.txt
```

---

## 4. Thay tháº¿ lá»‡nh cÆ¡ báº£n

Sá»­ dá»¥ng **`|`**, ta cÃ³ thá»ƒ gá»™p **`stdout`** cá»§a má»™t chÆ°Æ¡ng trÃ¬nh Ä‘áº¿n **`stdin`** cá»§a chÆ°Æ¡ng trÃ¬nh khÃ¡c. Sá»­ dá»¥ng **`>`** ta cÃ³ thá»ƒ chuyá»ƒn hÆ°á»›ng **`stdout`** Ä‘áº¿n má»™t file. Tuy nhiÃªn, cÃ³ nhá»¯ng lÃºc ta muá»‘n lÆ°u trá»¯ báº¥t cá»© chÆ°Æ¡ng trÃ¬nh gá»­i Ä‘áº¿n **`stdout`** hoáº·c sá»­ dá»¥ng nÃ³ nhÆ° Ä‘á»‘i sá»‘ dÃ²ng lá»‡nh cho chÆ°Æ¡ng trÃ¬nh khÃ¡c.

Äá»ƒ lÃ m Ä‘iá»u nÃ y, ta cÃ³ thá»ƒ sá»­ dá»¥ng cÃº phÃ¡p thay tháº¿ **`$(...)`**

**VÃ­ dá»¥:** ChÃºng ta muá»‘n kiá»ƒm tra quyá»n thá»±c thi trÃªn **`curl`**. ChÃºng ta khÃ´ng thá»ƒ Ä‘Æ¡n giáº£n cháº¡y lá»‡nh **`ls -l curl`**, nhÆ° tháº¿ thÃ¬ **`ls`** sáº½ tÃ¬m kiáº¿m file tÃªn lÃ  **`curl`** trong directory hiá»‡n táº¡i. Ngay cáº£ khi má»™t file khÃ´ng tá»“n táº¡i, nÃ³ khÃ´ng giá»‘ng vá»›i cÃ¡c Ä‘Æ°á»£c thá»±c thi khi ta cháº¡y lá»‡nh **`curl`**.

ChÃºng ta cÃ³ thá»ƒ biáº¿t ráº±ng **`curl`** á»Ÿ vá»‹ trÃ­ **``/usr/bin/curl``** hoáº·c chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng lá»‡nh **`which`** Ä‘á»ƒ láº¥y Ä‘Æ°á»ng dáº«n cá»¥ thá»ƒ cá»§a nÃ³ nhÆ° sau:

![AÌ‰nh chuÌ£p MaÌ€n hiÌ€nh 2020-08-02 luÌc 21.49.51.png](https://raw.githubusercontent.com/Zenfection/Image/master/2020/08/02-21-49-52-A%CC%89nh%20chu%CC%A3p%20Ma%CC%80n%20hi%CC%80nh%202020-08-02%20lu%CC%81c%2021.49.51.png)

BÃ¢y giá» ta cÃ³ thá»ƒ cháº¡y lá»‡nh **`ls -l /usr/bin/curl`**

![AÌ‰nh chuÌ£p MaÌ€n hiÌ€nh 2020-08-02 luÌc 21.50.51.png](https://raw.githubusercontent.com/Zenfection/Image/master/2020/08/02-21-50-58-A%CC%89nh%20chu%CC%A3p%20Ma%CC%80n%20hi%CC%80nh%202020-08-02%20lu%CC%81c%2021.50.51.png)

ChÃºng ta cÃ³ thá»ƒ náº¯m báº¯t Ä‘áº§u ra cá»§a lá»‡nh **`which curl`** vÃ  dÃ¡n nÃ³ vÃ o lá»‡nh **`ls -l`** trá»±c tiáº¿p nhÆ° báº±ng **`$(..)`** nhÆ° sau:

![AÌ‰nh chuÌ£p MaÌ€n hiÌ€nh 2020-08-02 luÌc 21.52.32.png](https://raw.githubusercontent.com/Zenfection/Image/master/2020/08/02-21-52-36-A%CC%89nh%20chu%CC%A3p%20Ma%CC%80n%20hi%CC%80nh%202020-08-02%20lu%CC%81c%2021.52.32.png)

### Thay tháº¿ `$(..)`

ChÃºng ta hoÃ n toÃ n cÃ³ thá»ƒ sá»­ dá»¥ng   **````..````** thay vÃ¬ **`$(..)`**. Hai cÃ¡i nhÆ° nhau, trÆ°á»›c Ä‘Ã¢y nÃ³ tÆ°Æ¡ng thá»©c ngÆ°á»£c vá»›i phiÃªn báº£n **`shell`** cÅ©, vÃ­ dá»¥ nhÆ° sau:

![AÌ‰nh chuÌ£p MaÌ€n hiÌ€nh 2020-08-02 luÌc 21.57.02.png](https://raw.githubusercontent.com/Zenfection/Image/master/2020/08/02-21-57-06-A%CC%89nh%20chu%CC%A3p%20Ma%CC%80n%20hi%CC%80nh%202020-08-02%20lu%CC%81c%2021.57.02.png)

| ğŸŒ [TÃ¬m hiá»ƒu thÃªm](http://www.tldp.org/LDP/abs/html/commandsub.html) |
| -------------------------------------------------------------------- |

## 5. Ná»‘i output vá»›i **`>>`**

Sá»­ dá»¥ng **`>`** Ä‘á»ƒ chuyá»ƒn hÆ°á»›ng ra cá»§a dÃ²ng lá»‡nh Ä‘áº¿n file sáº½ gÃ¢y ra toÃ n bá»™ ná»™i dung trong file bá»‹ ghi Ä‘Ã¨. 

XÃ©t **vÃ­ dá»¥** sau: nÃ³ sáº½ ghi ná»™i dung directory cá»§a home directory Ä‘áº¿n file cÃ³ tÃªn `homedir_contents.txt`:

```shell
ls -l ~ > homedir_contents.txt
```

Náº¿u `homedir_contents.txt` Ä‘Ã£ tá»“n táº¡i thÃ¬ dáº¥u **`>`** sáº½ ghi Ä‘Ã¨ ná»™i dung Ä‘Ã³.

Trong má»™t sá»‘ trÆ°á»ng há»£p, chÃºng ta cÃ³ thá»ƒ ná»‘i báº¥t ká»³ Ä‘áº§u ra ná»™i dá»¥ng cá»§a file tá»“n táº¡i hay hÆ¡n lÃ  pháº£i ghi Ä‘Ã¨ Ä‘Ã³. ChÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng **`>>`** Ä‘á»ƒ lÃ m viá»‡c Ä‘Ã³.

XÃ©t **vÃ­ dá»¥** má»Ÿ rá»™ng sau: (**`cat`** sáº½ in ra ná»™i dung cá»§a file Ä‘áº¿n **`stdout`**): `file1.txt` vÃ  `file2.txt`

```shell
$ cat file1.txt
cat: file1.txt : No such file or directory

$ echo "Apple" > file1.txt
$ cat file1.txt
Apple

$ echo "Banana" > file1.txt
$ cat file1.txt
Banana
```

```shell
$ cat file2.txt
cat: file2.txt : No such file or directory

$ echo "Apple" > file1.txt
$ cat file2.txt
Apple

$ echo "Banan" >> file2.txt
$ cat file2.txt
Apple
Banana
```

NhÆ° báº¡n Ä‘Ã£ tháº¥y, ná»™i dung trong `file1.txt` Ä‘Ã£ bá»‹ ghi Ä‘Ã¨ khi chÃºng ta sá»­ dá»¥ng **`>`**, trong khi chÃºng ta ná»‘i ná»™i dung má»›i `file2.txt` mÃ  khÃ´ng ghi Ä‘Ã¨ báº¥t ká»³ ná»™i dung nÃ o khi ta sá»­ dá»¥ng **`>>`**.

**ChÃº Ã½:** Trong má»¥c Ä‘Ã­ch ná»‘i thÃ¬ tÃ´i khuyÃªn báº¡n nÃªn dÃ¹ng **`cat`**.

---

## 6. Sá»­ khÃ¡c nhau giá»¯a `redirection`(chuyá»ƒn hÆ°á»›ng) vÃ  `pipe`(Ä‘Æ°á»ng á»‘ng)

**pipe** vÃ  **redirection** lÃ  hai khÃ¡i niá»‡m tÆ°Æ¡ng tá»±, nhÆ°ng sá»± khÃ¡c biá»‡t giá»¯a chÃºng lÃ  nhá»¯ng Ä‘iá»u sau Ä‘Ã¢y:

- `redirect` tham chiáº¿u Ä‘á»ƒ chuyá»ƒn cÃ¡c Ä‘áº§u ra Ä‘áº¿n **file** hoáº·c **stream**
- `pipe` tham chiáº¿u Ä‘á»ƒ chuyá»ƒn cÃ¡c Ä‘áº§u ra Ä‘áº¿n chÆ°Æ¡ng trÃ¬nh khÃ¡c hoáº·c tiá»‡n Ã­ch khÃ¡c

Táº¡m gá»i`p1` lÃ  má»™t chÆ°Æ¡ng trÃ¬nh khi cháº¡y nÃ³ sáº½ cho Ä‘áº§u ra nháº¥t Ä‘á»‹nh.

Äáº·t táº¥t cáº£ Ä‘áº§u ra bÃªn trong file (táº¡m gá»i lÃ  `myFile`), chuyá»ƒn hÆ°á»›ng lÃ  cáº§n thiáº¿tğŸŒ€:

```shell
$ p1 > myFile
```

Tuy nhiÃªn, Ä‘á»ƒ sá»­ dá»¥ng Ä‘áº§u ra nhÆ° Ä‘áº§u vÃ o cá»§a chÆ°Æ¡ng trÃ¬nh khÃ¡c (táº¡m gá»i lÃ  `p2`) lÃ  Ä‘iá»u khÃ¡c. CÃ³ má»™t file phá»¥ trá»£ Ä‘Æ°á»£c sá»­ dá»¥ng (táº¡m gá»i lÃ  `tmp_file`)ğŸŒ€ : 

```shell
$ p1 > tmp_file && p2 < tmp_file
```

Bá»Ÿi vÃ¬ nÃ³ duyá»‡t ráº¥t lÃ  vá»¥ng vá», **pipes** Ä‘Ã£ phÃ¡t minh ra Ä‘á»ƒ sá»­ dá»¥ng Ä‘iá»u Ä‘Ã³ dá»… hÆ¡n. Báº¡n cÃ³ thá»ƒ thá»±c hiá»‡n nhÆ° sau vá»›i cá»¥ phÃ¡p ngáº¯n gá»n nhÆ° sau:

```shell
$ p1 | p2
```

| ğŸ”™Â  [BÃ i 7.Shell](https://github.com/Zenfection/Linux-for-babies/blob/master/USER%20%26%20FILE%20MANAGEMENT/7.Shell.md) | [BÃ i 9.Quáº£n lÃ­ ngÆ°á»i dÃ¹ng](https://github.com/Zenfection/Linux-for-babies/blob/master/USER%20%26%20FILE%20MANAGEMENT/9.User%20Management.md)Â Â ğŸ”œ |
| ----------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------ |
