# CÃ´ng cá»¥ Pipeline (Ä‘Æ°á»ng á»‘ng)

## 1. Sá»­ dá»¥ng **`xargs`** Ä‘á»ƒ build lá»‡nh

Sá»­ dá»¥ng **`xargs`** Ä‘á»ƒ xÃ¢y dá»±ng vÃ  thá»±c thi lá»‡nh tá»« **`stdin`**. Äiá»u nÃ y thÆ°á»ng cung cáº¥p má»™t cáº¥u trÃºc Ä‘Æ¡n giáº£n hÆ¡n so vá»›i viá»‡c sá»­ dá»¥ng cÃ¡c vÃ²ng láº·p rÃµ rÃ ng

Xem **vÃ­ dá»¥ sau:**

```shell
$ echo 1 2 3 4 | xargs echo
// output 1 2 3 4
```

**flag** **`-n`** Ä‘á»ƒ xÃ¡c Ä‘á»‹nh Ä‘áº§u ra lá»›n nháº¥t cho má»—i dÃ²ng lá»‡nh:

```shell
$ echo 1 2 3 4 | xargs -n 2
// output (2 per line):
// 1 2
// 3 4
```

Giáº£ sá»­ báº¡n muá»‘n xoÃ¡ táº¥t cáº£ cÃ¡c **files** trong **``/path``**:

```shell
$ rm `find /path -type f`
```

Cháº¡y lá»‡nh trÃªn cÃ³ khi khÃ´ng thÃ nh cÃ´ng bá»Ÿi vÃ¬ cÃ³ ráº¥t nhiá»u **files** trong **``/path``**, vÆ°á»£t quÃ¡ Ä‘á»™ dÃ i dÃ²ng lá»‡nh cho phÃ©p.

Thay vÃ o Ä‘Ã³, hÃ£y cháº¡y dÃ²ng lá»‡nh nÃ y sáº½ á»•n hÆ¡n:

```shell
find /path -type f -print | xargs rm
```

Sá»± khÃ¡c nhau vá» **`xargs`** sáº½ in Ä‘áº§u vÃ o láº¥y tá»« **`find`** trong danh sÃ¡ch phá»¥ vÃ  gá»i lá»‡nh **`rm`** cho má»—i cÃ¡i.

Cho cÃ¡c lá»‡nh yÃªu cáº§u nhiá»u hÆ¡n má»™t Ä‘á»‘i sá»‘ táº¡i má»™t thá»i Ä‘iá»ƒm, trÃ¬nh táº¡o danh sÃ¡ch vá»›i Ä‘á»‘i sá»‘ máº·c Ä‘á»‹nh **`{}`** sá»­ dá»¥ng nhÆ° sau:

```shell
$ find . -name "*.bak" -print0 |
xargs -0 -I mv {} ~/old.files
```

Äáº§u ra tá»« **`find`** sáº½ thay tháº¿ cho má»i file tÃ¬m tháº¥y cáº£ 2 láº§n **`{}`** xuáº¥t hiá»‡n.

---

## 2. GiÃ¡m sÃ¡t quÃ¡ trÃ¬nh cá»§a dá»¯ liá»‡u qua Ä‘Æ°á»ng á»‘ng vá»›i **`pv`**

Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng **`pv`** Ä‘á»ƒ giÃ¡m sÃ¡t quÃ¡ trÃ¬nh cá»§a báº¥t ká»³ Ä‘Æ°á»ng á»‘ng nÃ o.

Äiá»u nÃ y cÃ³ thá»ƒ Ä‘Æ°á»£c báº±ng cÃ¡ch cÃ i Ä‘áº·t **`pv`** vÃ  Ä‘áº·t giá»¯a Ä‘áº§u vÃ o/Ä‘áº§u ra Ä‘Æ°á»ng á»‘ng.

Äá»ƒ cÃ i Ä‘áº·t **pv**:Â Â Â Â 

```shell
$ sudo apt-get install pv
```

**VÃ­ dá»¥:**Â Â Â Â 

```shell
$ dd if=/dev/urandom | pv | dd of=/dev/null
```

Äáº§u ra:

```shell
1,74MB : 0:00:09 [ 198kB/s] [ <=> ]
```

Báº¡n cÃ³ thá»ƒ xÃ¡c Ä‘á»‹nh gáº§n Ä‘Ãºng kÃ­ch thÆ°á»›c vá»›i **`-size`** náº¿u báº¡n muá»‘n khoáº£ng thá»i gian.

Báº¡n cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng nÃ³ Ä‘á»ƒ **output** **`stdout`**:

```shell
$ pv /home/user/bigfile.iso | md5sum
```

Äáº§u ra:

```shell
50,2MB 0:00:06 [8,66MB/s]
[==>  ] 49% ETA 0:00:06
```

**ChÃº Ã½:** Trong trÆ°á»ng há»£p nÃ y, **`pv`** nhÃ¬n nháº­n kÃ­ch thÆ°á»›c tá»± Ä‘á»™ng.

Sá»­ dá»¥ng **`pv`** chá»©ng minh ráº±ng nÃ³ vÃ´ cÃ¹ng há»¯u Ã­ch khi hoáº¡t Ä‘á»™ng vá»›i file kÃ­ch thÆ°á»›c lá»›n vÃ  quÃ¡ trÃ¬nh dÃ i Ä‘á»ƒ hoÃ n thÃ nh.

**VÃ­ dá»¥:** Báº¡n cÃ³ thá»ƒ theo dÃµi tá»‘c Ä‘á»™ cá»§a má»™t tá»‡p truyá»n Ä‘i vá»›i lá»‡nh **`nc`**:

```shell
$ pv myFile | nc -w 1 example.com 3000
```

---

## 3.TrÃ¹ng láº·p ná»™i dung Ä‘Æ°á»ng á»‘ng vá»›i **`tee`**

Äá»ƒ trÃ¹ng láº·p ná»™i dá»¥ng trong khi Ä‘Æ°á»ng á»‘ng báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng tiá»‡n Ã­ch **`tee`**

Má»™t cÃ¡ch Ä‘Æ¡n giáº£n vÃ  há»¯u hiá»‡u Ä‘á»ƒ vÃ­ dá»¥ ráº±ng **`tee`** cÃ³ thá»ƒ sá»­ dá»¥ng Ä‘á»ƒ ghi nhiá»u **files** Ä‘á»“ng thá»i.

Lá»‡nh Ä‘Ã³ thá»±c hiá»‡n nhÆ° sau:

```shell
$ ps | tee fileone filetwo filethree
```

Äáº§u ra cá»§a lá»‡nh **`ps`** bÃ¢y giá» lÃ  3 file khÃ¡c nhau.

Äá»ƒ ná»‘i **data** vá»›i **files**, Báº¯t buá»™c pháº£i sá»­ dá»¥ng **flag** **`-a`**:

```shell
$ ps | tee -a fileone filetwo filethree
```

### TÃ¬m hiá»ƒu thÃªm

| ğŸŒÂ [Lá»‡nh Tee](https://quantrimang.com/cach-dung-lenh-tee-trong-linux-164969) |
| ---------------------------------------------------------------------------- |

---

## 4. KÃ½ tá»± Shebang **`#!`**

KÃ½ tá»± Shebang (**`#!`**) Ä‘iá»n á»Ÿ Ä‘áº§u script sáº½ thÃ´ng bÃ¡o cho há»‡ Ä‘iá»u hÃ nh biáº¿t file script nÃ y sáº½ Ä‘Æ°á»£c thá»±c thi bá»Ÿi chÆ°Æ¡ng trÃ¬nh nÃ o.

Äá»ƒ thá»© Ä‘Ã³ hoáº¡t Ä‘á»™ng, script báº¯t buá»™c pháº£i Ä‘Æ°á»£c cáº¥p quyá»n thá»±c thi:

```shell
#!/bin/sh
#!/bin/bash
#!/usr/bin/perl
#!/usr/bin/tcl
#!/bin/sed -f
#!/bin/awk -f
```

Phá»¥ thuá»™c vÃ o tÃ¬nh huá»‘ng, chÃºng ta cÃ³ thá»ƒ cáº§n cháº¡y script vá»›i phiÃªn báº£n khÃ¡c nhau:

```shell
#!/usr/bin/python
#!/usr/bin/python3
```

Äá»ƒ Ä‘áº£m báº£o script cháº¡y Ä‘Æ°á»£c hÃ£y sá»­ dá»¥ng trÃ¬nh thÃ´ng dá»‹ch Ä‘áº§u tiÃªn trong **`PATH`** sá»­ dá»¥ng **``/usr/bin/env``**:

```shell
#!/usr/bin/env python
#!/usr/bin/env node
```

---

## 5. Chuyá»ƒn hÆ°á»›ng **`2>&1`**

Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng **`2>&1`** vÃ o cuá»‘i cá»§a má»™t lá»‡nh Ä‘á»ƒ káº¿t há»£p luá»“ng lá»—i vÃ o luá»“ng Ä‘áº§u ra.

**VÃ­ dá»¥:** **`1`** lÃ  **`stdout`** vÃ  **`2`** lÃ  **`stderr`**

Äáº§u tiÃªn, **`2>1`** Ä‘Ã³ giá»‘ng nhÆ° má»™t cÃ¡ch tá»‘t nháº¥t Ä‘á»ƒ chuyá»ƒn hÆ°á»›ng tá»« **`stderr`** sang **`stdout`**. Tuy nhiÃªn, nÃ³ tháº­t ra sáº½ thÃ´ng dá»‹ch lÃ  "chuyá»ƒn hÆ°á»›ng **`stderr`** thÃ nh má»™t file cÃ³ tÃªn lÃ  **`1`**".

Dáº¥u **`&`** biá»ƒu thá»‹ ráº±ng nhá»¯ng mÃ´ táº£ cá»§a má»™t **file** vÃ  khÃ´ng pháº£i tÃªn **file**. NÃªn lÃ  nÃ³ trá»Ÿ thÃ nh **`2>&1`**.

Äiá»u nÃ y cÃ³ thá»ƒ há»¯u dá»¥ng khi báº¡n muá»‘n **pipe** Ä‘áº§u ra thÃ´ng qua má»™t *chá»©c nÄƒng lá»c*:

```shell
$ ls -ld ~ /tnt 2>&1
        sed '/[nN]o/d'
# Ä‘iá»u nÃ y sáº½ in ra
drwxr-xr-x 18 osboxes osboxes 4096
        Jun 9 16:01 /home/osboxes
# Thay vÃ¬
ls: cannot access '/tnt': No such
drwxr-xr-x 18 osboxes osboxes 4096
        Jun 16:01 /home/osboxes
```

NÃ³ cÅ©ng cÃ³ kÃ½ hiá»‡u viáº¿t táº¯t káº¿t há»£p, NgoÃ i ra cÃ²n cÃ³ kÃ½ hiá»‡u viáº¿t táº¯t káº¿t há»£p luá»“ng há»£p nháº¥t vá»›i chuyá»ƒn hÆ°á»›ng Ä‘áº§u ra:

```shell
$ ./script.sh > /dev/null
```

```shell
$ ./script.sh &> /dev/null
```

Hai lá»‡nh trÃªn cÃ³ Ä‘áº§u ra giá»‘ng nhau

### [TÃ¬m hiá»ƒu thÃªm](https://stackoverflow.com/questions/818255/in-the-shell-what-does-21-mean)

| ğŸ”™Â [BÃ i 16.Lá»‹ch sá»­ Terminal](https://github.com/Zenfection/Linux-for-babies/blob/master/USER%20%26%20FILE%20MANAGEMENT/16.Terminal%20history.md) | [BÃ i 18.Tiá»‡n Ã­ch quáº£n lÃ­ ngÆ°á»i dÃ¹ng](https://github.com/Zenfection/Linux-for-babies/blob/master/USER%20%26%20FILE%20MANAGEMENT/18.user%20management%20utilities.md)Â ğŸ”œ |
| ------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
