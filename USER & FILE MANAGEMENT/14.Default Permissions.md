# Quyá»n truy cáº­p máº·c Ä‘á»‹nh

## 1. Hiá»ƒu vá» **`umask`**

Má»i **file** vÃ  **directory** láº¥y má»™t sá»‘ quyá»n máº·c Ä‘á»‹nh khi táº¡o. Nhá»¯ng giÃ¡ trá»‹ Ä‘Ã³ Ä‘Æ°á»£c sá»­ dá»¥ng **`umask`**.

Quyá»n truy cáº­p máº·c Ä‘á»‹nh cá»§a má»™t **directory** láº¥y khi táº¡o sáº½ lÃ  **`777`** (rwx-rwx-rwx), giÃ¡ trá»‹ sáº½ Ä‘Æ°á»£c che Ä‘i bá»Ÿi **`umask`**

Quyá»n truy cáº­p máº·c Ä‘á»‹nh cá»§a má»™t **file** lÃ  **`666`** (rw-rw-rw), giÃ¡ trá»‹ sáº½ Ä‘Æ°á»£c che Ä‘i bá»Ÿi **`umask`**

**Mask** tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i viá»‡c táº¯t cÃ¡c quyá»n truy cáº­p bits- náº¿u quyá»n truy cáº­p khÃ´ng tá»“n táº¡i. **`umask`** sáº½ káº¿t thÃºc khÃ´ng lÃ m gÃ¬.

Báº¡n cÃ³ thá»ƒ kiá»ƒm tra giÃ¡ trá»‹ **`umask`** nhÆ° sau:

```shell
umask
0022
# NÃ³ sáº½ cho phÃ©p quyá»n truy cáº­p sau
# cho má»™t file má»›i
touch new-file
ls -l new-file
-rw-r--r-- 1 user group 0 new-file

# cho má»™t directory má»›i
mkdir new-dir
ls -l new-dir
drwxr-xr-x 2 user group 4096 ./
```

Äá»ƒ thay Ä‘á»•i **`umask`** cá»§a pháº§n hiá»‡n táº¡i sang **`007`**, hÃ£y cháº¡y má»™t trong lá»‡nh sau:

```shell
umask 077
```

```shell
umask u+rwx,g-rwx,o-rwx
```

```shell
umask u=rwx,g=,o=

# + báº­t quyá»n truy cáº­p Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh
# - táº¯t quyá»n truy cáº­p Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh
# = báº­t vÃ  táº¯t cÃ¡c thá»© khÃ¡c Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh
```

```shell
umask 0700
```

Äá»ƒ Ã¡p dá»¥ng cho táº¥t cáº£ ngÆ°á»i dÃ¹ng cá»§a há»‡ thá»‘ng báº¡n nÃªn thÃªm nÃ³ vÃ o file **``/etc/profile``** vÃ  file **``~/.bashrc``**.

## 2. Quyá»n truy cáº­p **`setgid`**

Quyá»n truy cáº­p **`setgid`** viáº¿t táº¯t cá»§a **set group id**. Quyá»n truy cáº­p tÆ°á»£ng tá»± nhÆ° **`setuid`**, ngoáº¡i trá»« ID nhÃ³m hiá»‡u quáº£ cá»§a quy trÃ¬nh Ä‘Æ°á»£c thay Ä‘á»•i thÃ nh chá»§ sá»Ÿ há»¯u nhÃ³m cá»§a file, truy cáº­p cá»§a ngÆ°á»i dÃ¹ng Ä‘Æ°á»£c cáº¥p dá»±a trÃªn quyá»n truy cáº­p giao cho nhÃ³m Ä‘Ã³. VÃ¬ tháº¿ **file** thuá»™c vá» **group** sá»Ÿ há»¯u bá»Ÿi **directory**, khÃ´ng thuá»™c quyá»n sá»Ÿ há»¯u nhÃ³m cá»§a ngÆ°á»i dÃ¹ng

Khi quyá»n truy cáº­p **`setgid`** Ä‘Æ°á»£c Ã¡p dá»¥ng trong **directory** thÃ¬ **files** nÃ o Ä‘Æ°á»£c táº¡o bÃªn trong **directory** thuá»™c vá» **group**.

Äá»ƒ thiáº¿t láº­p bit **`setgid`** trÃªn file, lÃ m nhÆ° sau:

```shell
chmod g+s zenscript
```

XoÃ¡ bit **`setgid`**, lÃ m nhÆ° sau:

```shell
chmod g-s zenscript
```

Äá»ƒ xoÃ¡ cáº£ 2 **`setuid`** vÃ  **`setgid`** vá»›i thay tháº¿ báº±ng bÃ¡t phÃ¢n:

```shell
chmod 0777 zenscript
```

TÃ¬m táº¥t cáº£ file vá»›i **`setgid`** lÃ m nhÆ° sau:

```shell
find / -type f -perm /2000 -exec stat -c "%A %a %n" {} \;
```

---

## 3. Quyá»n truy cáº­p **`setuid`**

**`setuid`** (**SET U**ser **ID** upon execution), lÃ  má»™t loáº¡i Ä‘áº·c quyá»n file (file permission) Ä‘áº·c biá»‡t, cÃ³ thá»ƒ cho phÃ©p user táº¡m cÃ³ quyá»n thá»±c thi file báº±ng chÃ­nh quyá»n cá»§a ngÆ°á»i sá»Ÿ há»¯u (owner) Ä‘á»ƒ thay Ä‘á»•i hÃ nh vi cá»§a file thá»±c thi Ä‘Ã³. Hay nÃ³i má»™t cÃ¡ch Ä‘Æ¡n giáº£n hÆ¡n: *â€œThÃ´ng thÆ°á»ng má»™t file trong linux khi cháº¡y thÃ¬ sáº½ Ä‘Æ°á»£c káº¿ thá»«a tá»« user Ä‘ang log in. SETUID sáº½ cáº¥p quyá»n â€œtáº¡m thá»iâ€ cho user cháº¡y file quyá»n cá»§a user táº¡o ra file (owner). NÃ³i má»™t cÃ¡ch khÃ¡c, user cháº¡y sáº½ cÃ³ UID vÃ  GID cá»§a ngÆ°á»i táº¡o ra file, khi cháº¡y 1 file hay command.â€*

**VÃ­ dá»¥:** Quyá»n truy cáº­p **`setuid`** trÃªn lá»‡nh **`passwd`** cho phÃ©p ngÆ°á»i dÃ¹ng thay Ä‘á»•i **password** tÆ°á»£ng tá»± quyá»n **`root`**.

```shell
ll /usr/bin/passwd
 -rwsr-xr-x 1 root /usr/bin/passwd
```

**`s`** trong quyá»n truy cáº­p cho tháº¥y quyá»n truy cáº­p Ä‘Æ°á»£c thiáº¿t láº­p.

ChÃºng ta cÃ³ thá»ƒ thiáº¿t láº­p quyá»n truy cáº­p Ä‘áº·c biá»‡t nhÆ° sau:

```shell
chmod +s file
```

---

## 4. Quyá»n truy cáº­p **`sticky bit`**

**`Sticky bit`** Ä‘Æ°á»£c sá»­ dá»¥ng cho cÃ¡c thÆ° má»¥c chia sáº», má»¥c Ä‘Ã­ch lÃ  ngÄƒn cháº·n viá»‡c ngÆ°á»i dÃ¹ng nÃ y xÃ³a file cá»§a ngÆ°á»i dÃ¹ng kia. Chá»‰ duy nháº¥t owner file (vÃ  **`root`**) má»›i cÃ³ quyá»n rename hay xÃ³a cÃ¡c file, thÆ° má»¥c khi nÃ³ Ä‘Ã£ Ä‘Æ°á»£c set **`sticky bit`**. **`sticky bit`** Ä‘Æ°á»£c mÃ´t táº£ báº±ng chá»¯ cÃ¡i â€œtâ€ á»Ÿ dÃ²ng cuá»‘i cÃ¹ng cá»§a hiá»ƒn thá»‹ **permission**.

Quyá»n truy cáº­p Ä‘áº·c biá»‡t nÃ y cÃ³ thá»ƒ ngÄƒn ngÆ°á»i dÃ¹ng xoÃ¡ **files** ngÆ°á»i dÃ¹ng khÃ¡c tá»« **public directory**, cháº³ng háº¡n nhÆ° lá»‡nh **`/tmp`**:

```shell
ll.
drwxrwxrwt 17 root root 4096 Jul 20 01:09 ./
```

**`t`** á»Ÿ cuá»‘i quyá»n truy cáº­p cÃ³ nghÄ©a lÃ  **`sticky bit`** Ä‘ang hoáº¡t Ä‘á»™ng á»Ÿ **folder** nÃ y

CÃ¡ch Ä‘á»ƒ thiáº¿t láº­p **Sticky bit**:

```shell
chmod +t file
```

CÃ¡ch huá»· thiáº¿t láº­p:

```shell
chmod -t file
```

---

## 5. LÃ m cho má»™t file khÃ´ng thá»ƒ thay Ä‘á»•i báº±ng **`chattr`**

Báº¡n cÃ³ thá»ƒ lÃ m cho má»™t file khÃ´ng thá»ƒ thay Ä‘á»•i hoáº·c xoÃ¡ Ä‘i ká»ƒ cáº£ quyá»n **`root`** nhÆ° sau:

```shell
sudo chattr +i /path/to/file
```

Sau Ä‘Ã³ file Ä‘Ã³ sáº½ thÃ nh *untouchable*

Äá»ƒ lÃ m nÃ³ cÃ³ thá»ƒ thay Ä‘á»•i trá»Ÿ láº¡i, hÃ£y dÃ¹ng **flag** **`-i`** nhÆ° sau:

```shell
sudo chattr -i /path/to/file
```

HÃ£y sá»­ dá»¥ng **flag** **`-R`** Ä‘á»ƒ unlock directory nhÆ° sau:

```shell
sudo chattr -R -i directory/
```

Há»‡ Ä‘iá»u hÃ nh Mac lÃ :Â Â 

- Äá»ƒ lock file:

```shell
chflags uchg /path/to/file
```

- Äá»ƒ unlock file:

```shell
chflags nouchg /path/to/file
```

| ğŸ”™Â [BÃ i 13.Máº¹o quáº£n lÃ­ file pháº§n 2](https://github.com/Zenfection/Linux-for-babies/blob/master/USER%20%26%20FILE%20MANAGEMENT/13.File%20Management%20tips%202.md) |     |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------- | --- |
