# Quyá»n truy cáº­p ngÆ°á»i dÃ¹ng

## 1. Users vÃ  Groups trong Linux

Linux lÃ  má»™t há»‡ Ä‘iá»u hÃ nh cÃ³ nhiá»u ngÆ°á»i dÃ¹ng, giá»‘ng nhÆ° nhá»¯ng há»‡ Ä‘iá»u hÃ nh nhiá»u ngÆ°á»i dÃ¹ng khÃ¡c, nÃ³ lÃ  khÃ¡i niá»‡m cá»§a `permissions`, vÃ¬ theo máº·c Ä‘á»‹nh, ngÆ°á»i ta khÃ´ng muá»‘n má»™t ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ chá»‰nh sá»­a cÃ¡c **files** cá»§a ngÆ°á»i dÃ¹ng khÃ¡c. CÃ³ 2 khÃ¡i niá»‡m chÃ­nh cho `permissions` lÃ  : `users` vÃ  `groups`.

`Groups` lÃ  táº­p há»£p tá»« 0 tá»›i nhiá»u `users` vÃ  má»™t `users` cÃ³ thá»ƒ cÃ³ nhiá»u `groups`. **Files**, **directory** vÃ  file thá»±c thi... cÃ³ thá»ƒ cáº¥p quyá»n cáº£ `users` vÃ  `groups`

Má»™t sá»‘ **vÃ­ dá»¥:**

1. NgÆ°á»i ta cÃ³ thá»ƒ táº¡o ra má»™t `group` gá»i lÃ  **`print`** mÃ  cÃ¡c thÃ nh viÃªn cÃ³ thá»ƒ sá»­ dá»¥ng mÃ¡y in khi Ä‘Æ°á»£c gáº¯n vÃ o mÃ¡y tÃ­nh
2. NgÆ°á»i ta cÃ³ thá»ƒ táº¡o ra má»™t `group` gá»i lÃ  `log` mÃ  cÃ¡c thÃ nh viÃªn cÃ³ quyá»n truy cáº­p vÃ o Ä‘á»c **file** trong **``/var/log``**.
3. NgÆ°á»i ra cÃ³ thá»ƒ táº¡o ra má»™t `group` gá»i lÃ  `ssh` mÃ  cÃ¡c thÃ nh viÃªn cÃ³ quyá»n Ä‘Äƒng nháº­p Ä‘iá»u khiá»ƒn thÃ´ng qua **SSH**

ÄÃ³ lÃ  nhá»¯ng vÃ­ dá»¥ cá»§a `group`. NgÆ°á»i ta cÃ³ thá»ƒ thay Ä‘á»•i cÃ¡c **files** cá»¥ thá»ƒ vÃ  thay Ä‘á»•i `permissions` cá»§a há»‡ thá»‘ng cÅ©ng nhÆ° mÃ´ táº£, táº¥t cáº£ Ä‘á»u cÃ³ thá»ƒ.

### Danh sÃ¡ch `Groups`

**file** **``/etc/group``** chá»©a danh sÃ¡ch má»i `group` trong há»‡ thá»‘ng. HÃ£y cháº¡y lá»‡nh **`cat /etc/group`** báº¡n sáº½ tháº¥y Ä‘Æ°á»£c toÃ n bá»™ danh sÃ¡ch cá»§a `group` (hoáº·c cháº¡y lá»‡nh **`less /etc/group`** Ä‘á»ƒ trÃ£i nghiá»‡m thao tÃ¡c tá»‘t hÆ¡n).

Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng lá»‡nh **`groups`** Ä‘á»ƒ tháº¥y ngÆ°á»i dÃ¹ng Ä‘ang á»Ÿ group nÃ o nhÆ° sau:

```shell
$ groups Zenfection
Zenfection : admin www-data rvm
$
```

**`Zenfection`** lÃ  tÃªn ngÆ°á»i dÃ¹ng, vÃ  á»Ÿ Ä‘Ã¢y cÃ³ 3 group gá»“m : **`admin`**, **`www-data`** vÃ  **`rvm`**.

---

## 2. File Ownership

Trong Linux, má»i **file** vÃ  **directory** Ä‘á»u Ä‘Æ°á»£c `user owner` vÃ  `group owner`. Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng lá»‡nh **`ls -l`** hoáº·c **`ls -ld`** Ä‘á»ƒ xem quyá»n sá»Ÿ há»¯u cá»§a **files** hoáº·c **`directory`**.

Xem **vÃ­ dá»¥** sau:

```shell
ls -ld /var/log
drwrwxr-x 10 root syslog
    4096 Jun 13 06:25 /var/log
ls -l /var/log/syslog
-rw-r
```

| ğŸŒÂ [TÃ¬m hiá»ƒu thÃªm](https://wiki.archlinux.org/index.php/File_permissions_and_attributes) |
| ---------------------------------------------------------------------------------------- |

---

## 3. Thay Ä‘á»•i Ownership báº±ng **`chown`**

Lá»‡nh **`chown`** cho phÃ©p chugn1 ta thay Ä‘á»•i Ä‘á»“ng thá»i `user` vÃ  `group` cá»§a chá»§ sá»¡ há»¯u cá»§a **files** vÃ  **directories**. Cháº¡y lá»‡nh nÃ y cáº§n pháº£i cÃ³ quyá»n **`root`** nÃªn pháº£i kÃ¨m lá»‡nh **`sudo`**

Äá»ƒ thay Ä‘á»•i `user` lÃ  chá»§ sá»¡ há»¯a má»™t file cá»¥ thá»ƒ cháº¡y nhá»¯ng dÃ²ng lÃªnh sau: 

```shell
sudo chown [username] /path/to/some/file
```

Äá»ƒ thay Ä‘á»•i cáº£ `user` vÃ  `group` hÃ£y cháº¡y lá»‡nh sau: (Ä‘iá»n thÃ´ng tin trong dáº¥u **`[]`**)

```shell
sudo chown [username]:[new-group] /path/to/some/file
```

Äá»ƒ chá»‰ thay Ä‘á»•i group cháº¡y lÃªnh sau:

```shell
sudo chown :[new-group] /path/to/some/file 
```

> ğŸ’¡ Náº¿u báº¡n khÃ´ng khÃ´ng cÃ³ quyá»n **`root`**, báº¡n cÃ³ thá»ƒ thay Ä‘á»•i `permissions` cá»§a file báº±ng cÃ¡ch sá»­ dá»¥ng lá»‡nh **`chmod`**. **Náº¿u báº¡n lÃ  chá»§ sá»Ÿ há»¯a cá»§a file Ä‘Ã³** thÃ¬ Ä‘Æ°á»£c. Báº¡n khÃ´ng thá»ƒ thay Ä‘á»•i `ownership` (vá»›i lá»‡nh **`chown`** hoáº·c **`chgrp`**) mÃ  khÃ´ng cÃ³ quyá»n **`root`**

### Thay Ä‘á»•i Ownership Ä‘á»‡ quy (tá»©c lÃ  má»i file bÃªn trong Ä‘á»u thay Ä‘á»•i)

CÃ³ nhá»¯ng lÃºc cáº§n thiáº¿t thay Ä‘á»•i `user/group` cho ngÆ°á»i sá»Ÿ há»¯u á»Ÿ táº¥t cáº£ má»i `file` vÃ  `subdirectory` bÃªn trong má»™t `directory`. HÃ£y sá»­ dá»¥ng tuá»³ chá»n **`-R`** Ä‘á»ƒ lÃ m Ä‘iá»u nÃ y, nhÆ°ng hÃ£y **cáº©n tháº­n**: báº¡n khÃ´ng muá»‘n vÃ´ tÃ¬nh thay Ä‘á»•i quyá»n sá»¡ há»¯u cá»§a váº¡n file bá»‹ lá»—i.

HÃ£y nhÃ¬n **cÃº phÃ¡p** sau:

```shell
$ sudo chown -R [username]:[new-group] /some/directory
```

> âš ï¸ Lá»‡nh nÃ y khÃ´ng háº³n chá»‰ thay Ä‘á»•i quyá»n sá»Ÿ há»¯u cá»§a **``/some/directory``**, nhÆ°ng má»i **file** vÃ  **subdirectory** sáº½ bá»‹ thay Ä‘á»•i.

### TÃ¬m hiá»ƒu thÃªm

| ğŸŒÂ [Lá»‡nh chown](https://www.man7.org/linux/man-pages/man1/chown.1.html) | ğŸŒÂ [Lá»‡nh chgrp](https://man7.org/linux/man-pages/man1/chgrp.1.html) |
| ----------------------------------------------------------------------- | ------------------------------------------------------------------- |

## 4. Thay Ä‘á»•i quyá»n truy cáº­p file báº±ng **`chmod`**

Trong khi lá»‡nh **`chown`** cho phÃ©p chÃºng thay Ä‘á»•i quyá»n sá»Ÿ há»¯u cá»§a **file**, thÃ¬ lá»‡nh **`chmod`** cho phÃ©p quyá»n truy cáº­p.

CÃ³ ráº¥t nhiá»u cÃ¡ch sá»­ dá»¥ng lá»‡nh **`chmod`**, nÃªn báº¡n hÃ£y gÃµ lá»‡nh **`man chmod`** trÃªn terminal Ä‘á»ƒ Ä‘á»c hÆ°á»›ng dáº«n sá»­ dá»¥ng.

### ThÃªm vÃ  xoÃ¡ quyá»n truy cáº­p

Báº¯t Ä‘áº§u vá»›i 3 vÃ­ dá»¥ sau:

```shell
# Cáº¥p quyá»n ngÆ°á»i dÃ¹ng ghi á»Ÿ file ~/kietdeptrai.txt
$ chmod u+w ~/kietdeptrai.txt  
```

```shell
# Cáº¥p quyá»n ghi cho group á»Ÿ file ~/kietdeptrai.txt
$ chmod g+w ~/kietdeptrai.txt
```

```shell
# Cáº¥p quyá»n ghi cho má»i ngÆ°á»i á»Ÿ file ~/kietdeptrai.txt
$ chmod o+w ~/kietdeptrai.txt
```

**`u+r`**: (user readable): ngÆ°á»i dÃ¹ng Ä‘á»c file

**`g+r`**:  (group readable): group Ä‘á»c file

**`o+r`**: (everyone readable): má»i ngÆ°á»i cÃ³ thá»ƒ Ä‘á»c file

**`+x`**: quyá»n thá»±c thi

Náº¿u thay vÃ¬ chÃºng ta sá»­ dá»¥ng **`u-w`** hoáº·c **`u-r`**, chÃºng ta cÃ³ thá»ƒ *xoÃ¡* quyá»n ghi/Ä‘á»c cho ngÆ°á»i dÃ¹ng hiá»‡n táº¡i.

ChÃºng ta cÃ³ thá»ƒ tháº¥y rÃµ hÆ¡n sá»± thay Ä‘á»•i thÃ´ng qua lá»‡nh **`ls`**:

```shell
$ ls -l kietdeptrai.txt
-rw-r--r-- 1 zenfection admin
    0 Jun 13 08:45 kietdeptrai.txt

$ chmod g+w kietdeptrai.txt
$ ls -l kietdeptrai.txt
-rw-rw-r-- 1 zenfection admin
    0 Jun 13 08:45 kietdeptrai.txt

$ chmod o+w kietdeptrai.txt
$ ls -l kietdeptrai.txt
-rw-rw-rw- 1 zenfection admin
    0 Jun 13 08:45 kietdeptrai.txt

$ chmod g-w kietdeptrai.txt
$ ls -l kietdeptrai.txt
-rw-r--rw- 1 zenfection admin
    0 Jun 13 08:45 kietdeptrai.txt
$   
```

Báº¡n cÃ³ thá»ƒ tháº¥y sá»± thay Ä‘á»•i rÃµ rÃ ng thÃ´ng qua dÃ²ng lá»‡nh **`ls -l`** rá»“i Ä‘áº¥y.

---

## 5. Thay Ä‘á»•i thÃ nh viÃªn trong group vá»›i **`usermod`**

Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng lá»‡nh **`usermod`** Ä‘á»ƒ thÃªm user vÃ  má»™t `group` cá»¥ thá»ƒ. CÃº phÃ¡p nhÆ° sau:

```shell
$ sudo usermod -a -G [new-group] [username]
```

Báº¡n thay tháº¿ `username` vÃ  `new-group` trong dáº¥u **`[]`** nhÆ° báº¡n mong muá»‘n. Tuá»³ chá»n **`-a`** nghÄ©a lÃ  **"append"**, Ä‘á»ƒ khÃ´ng cho **`usermod`** ghi  Ä‘Ã¨ nhá»¯ng thÃ nh viÃªn tá»“n táº¡i trong `group`. Tuá»³ chá»n **`-G`** lÃ  thÃªm user vÃ o 1 nhÃ³m cá»¥ thá»ƒ.

*XoÃ¡* thÃ nh viÃªn trong group sáº½ phá»©c táº¡p hÆ¡n. Náº¿u sá»­ dá»¥ng cÃ³ sáºµn thÃ¬ nÃªn dÃ¹ng lá»‡nh **`gpasswd`**, cÃº phÃ¡p sá»­ dá»¥ng nhÆ° sau:

```shell
$ sudo gpasswd -d [username] [new-group]
```
