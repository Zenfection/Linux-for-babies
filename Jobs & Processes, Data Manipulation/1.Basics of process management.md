# Ná»n táº£ng cá»§a quáº£n lÃ­ tiáº¿n trÃ¬nh

## 1. Danh sÃ¡ch tiáº¿n trÃ¬nh sá»­ dá»¥ng **`ps`**

Lá»‡nh **`ps`** (viáº¿t táº¯t cá»§a *process status*) hiá»ƒn thá»‹ thÃ´ng tin vá» tiáº¿n trÃ¬nh Ä‘ang cháº¡y hiá»‡n táº¡i.

KhÃ´ng cáº§n báº¥t ká»³ **`flags`** nÃ o, **`ps`** sáº½ hiá»ƒn thá»‹ táº¥t cáº£ tiáº¿n trÃ¬nh Ä‘Ã£ báº¯t Ä‘áº§u bá»Ÿi ngÆ°á»i dÃ¹ng hiá»‡n táº¡i

**VÃ­ dá»¥:**Â Â Â Â 

![2020-08-11 15.09.36.gif](https://raw.githubusercontent.com/Zenfection/Image/master/2020/08/11-15-10-01-2020-08-11%2015.09.36.gif)

Trong Ä‘Ã³ thÃ¬:

- **`PID`**: ID cá»§a tiáº¿n trÃ¬nh
- **`TTY`**: **Terminal** mÃ  lá»‡nh Ä‘Æ°á»£c khá»Ÿi cháº¡y
- **`TIME`**: Khoáº£ng thá»i gian tiáº¿n trÃ¬nh Ä‘Ã£ cháº¡y
- **`CMD`**: tÃªn cá»§a lá»‡nh (**command**)

Má»™t cÃ¡ch sá»­ dá»¥ng phá»• biáº¿n cá»§a **`ps`** lÃ  **`ps aux`**, nÃ³ sáº½ hiá»ƒn thá»‹ má»i tiáº¿n trÃ¬nh Ä‘ang cháº¡y trÃªn há»‡ thá»‘ng dá»c theo vá»›i thÃ´ng tin bá»• sung (CPU,memory sá»­ dá»¥ng, user khá»Ÿi cháº¡y...)

NÃ³ cÅ©ng thÆ°á»ng sá»­ dá»¥ng **`ps aux`** káº¿t há»£p vá»›i **`grep`** Ä‘á»ƒ tÃ¬m kiáº¿m tiáº¿n trÃ¬nh cá»¥ thá»ƒ. HÃ£y nhÃ¬n náº¿u server **SSH** **`sshd`** Ä‘ang cháº¡y, hÃ£y cháº¡y dÃ²ng lá»‡nh sau Ä‘Ã¢y:

```shell
$ ps aux | grep sshd
```

![2020-08-11 15.16.20.gif](https://raw.githubusercontent.com/Zenfection/Image/master/2020/08/11-15-17-28-2020-08-11%2015.16.20.gif)

NhÆ° báº¡n Ä‘Ã£ tháº¥y, **`zenfection`** chÃ­nh lÃ  user, **`2172`** chÃ­nh lÃ  ID cá»§a tiáº¿n trÃ¬nh, cÃ²n nhá»¯ng thÃ´ng tin cÃ²n láº¡i bao gá»“m time,  memory...

### TÃ¬m hiá»ƒu thÃªm

| ğŸŒÂ Â [Tiáº¿n trÃ¬nh cÆ¡ báº£n](http://www.tldp.org/LDP/intro-linux/html/sect_04_01.html) |
| --------------------------------------------------------------------------------- |

---

## 2. CÃ¢y tiáº¿n trÃ¬nh

Má»i tiáº¿n trÃ¬nh Ä‘Ã£ khá»Ÿi cháº¡y (hoáº·c "forked") bá»Ÿi má»™t tiáº¿n trÃ¬nh nÃ o khÃ¡c. CÃ³ má»™t quÃ¡ trÃ¬nh **`root`** Ä‘áº·c biá»‡t (gá»i lÃ  "**init**") Ä‘Æ°á»£c khá»Ÿi cháº¡y má»™t cÃ¡ch trá»±c tiáº¿p bá»Ÿi **kernel** khi há»‡ thá»‘ng Ä‘áº§u tiÃªn cá»§a báº¡n khá»Ÿi Ä‘á»™ng.

Theo cÃ¡ch nÃ y, táº­p há»£p cÃ¡c tiáº¿n trÃ¬nh Ä‘ang cháº¡y trong há»‡ thá»‘ng lÃ  máº«u cá»§a má»™t "tiáº¿n trÃ¬nh cÃ¢y"(*process tree*) báº¯t nguá»“n tá»« tiáº¿n trÃ¬nh **init**. Má»i tiáº¿n trÃ¬nh Ä‘á»u cÃ³ nhá»¯ng tiáº¿n trÃ¬nh cha cá»§a nÃ³ vÃ  cÃ³ kháº£ nÄƒng cÃ³ nhiá»u tiáº¿n trÃ¬nh con.

**VÃ­ dá»¥:** Má»i lÃºc abn5 cháº¡y lá»‡nh trong khi á»Ÿ promt **`bash`**, **`bash`** sáº½ **fork** má»™t tiáº¿n trÃ¬nh má»›i Ä‘á»ƒ cháº¡y lá»‡nh cá»§a báº¡n, lÃ m cho tiáº¿n trÃ¬nh Ä‘Ã³ trá»Ÿ thÃ nh tiáº¿n trÃ¬nh con cá»§a **`bash`** hiá»‡n táº¡i.

CÅ©ng nhÆ° tháº¿, khi báº¡n nhÃ¬n tháº¥y "log in" trÃªn promt, thá»±c cháº¥t lá»‡nh **`login`** Ä‘ang cháº¡y. Náº¿u báº¡n log in thÃ nh cÃ´ng, lá»‡nh **`login`** sáº½ **fork** má»™t tiáº¿n trÃ¬nh má»›i Ä‘á»ƒ thá»±c thi.

Lá»‡nh **`ps`** hiá»ƒn thá»‹ danh sÃ¡ch pháº³ng cá»§a tiáº¿n trÃ¬nh, nhÆ°ng báº¡n muá»‘n sá»­ dá»¥ng lá»‡nh **`pstree`** náº¿u báº¡n muá»‘n xem hiá»ƒn thá»‹ dáº¡ng danh sÃ¡ch cÃ¢y.

**Máº«u danh sÃ¡ch cÃ¢y cá»§a tiáº¿n trÃ¬nh cá»§a há»‡ thá»‘ng Mac OS (Unix):**

![2020-08-11 15.44.45.gif](https://raw.githubusercontent.com/Zenfection/Image/master/2020/08/11-15-45-40-2020-08-11%2015.44.45.gif)

Báº¡n cÅ©ng cÃ³ thá»ƒ dÃ¹ng lá»‡nh **`ps auxf`** Ä‘á»ƒ xem hiá»ƒn thá»‹ dáº¡ng cÃ¢y, máº·c dÃ¹ Ä‘áº§u ra khÃ´ng máº¥y thÃ¢n thiá»‡n ngÆ°á»i dÃ¹ng láº¯m.

---

## 3. Ná»n táº£ng cá»§a tiáº¿n trÃ¬nh Ownership

Má»i tiáº¿n trÃ¬nh "*owned*" bá»Ÿi má»™t ngÆ°á»i dÃ¹ng nháº¥t Ä‘á»‹nh. Tiáº¿n trÃ¬nh **owned** bá»Ÿi má»™t ngÆ°á»i dÃ¹ng cÃ³ quyá»n truy cáº­p lÃ m báº¥t ká»³ thá»© gÃ¬ mÃ  ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ lÃ m náº¿u há» Ä‘Äƒng nháº­p trá»±c tiáº¿p.

**VÃ­ dá»¥:** Náº¿u báº¡n trÃ¬nh Ä‘Ã£ **owned** bá»Ÿi **`zen`** sau Ä‘Ã³ quÃ¡ trÃ¬nh Ä‘Ã³ cÃ³ quyá»n truy cáº­p lÃ m má»i thá»©: **`zen`** cÃ³ thá»ƒ sá»­a **files** trong **home directory**, báº¯t Ä‘áº§u má»™t tiáº¿n trÃ¬nh má»›i...

Tiáº¿n trÃ¬nh há»‡ thá»‘ng nhÆ° **`init`** vÃ  **`login`** lÃ  **owned** (quyá»n sá»Ÿ há»¯u) bá»Ÿi **`root`** vÃ  khi tiáº¿n trÃ¬nh **`root`**-owned **forks** má»™t tiáº¿n trÃ¬nh má»›i, cÃ³ kháº£ nÄƒng sáº½ thay Ä‘á»•i chá»§ sá»Ÿ há»¯u (**owner**) cá»§a tiáº¿n trÃ¬nh con.

Do Ä‘Ã³, khi báº¡n Ä‘Äƒng nháº­p vÃ o lá»‡nh **`login`** sáº½ **fork** ra má»™t tiáº¿n trÃ¬nh má»›i cháº¡y **`shell`** cá»§a báº¡n, nhÆ°ng tiáº¿n trÃ¬nh má»›i sáº½ **owned** bá»Ÿi ngÆ°á»i dÃ¹ng Ä‘Ã£ Ä‘Äƒng nháº­p thÃ nh cÃ´ng. Báº¥t ká»³ lá»‡nh tiáº¿p theo nÃ o khá»Ÿi cháº¡y sáº½ thuá»™c sá»Ÿ há»¯u cá»§a ngÆ°á»i dÃ¹ng Ä‘Ã£ Ä‘Äƒng nháº­p.

Bá»Ÿi vÃ¬ chá»‰ cÃ³ duy nháº¥t tiáº¿n trÃ¬nh **`root`** cÃ³ thá»ƒ thay Ä‘á»•i quyá»n sá»Ÿ há»¯u trong cÃ¡ch nÃ y.

---

## 4. Há»‡ thá»‘ng **`init`** lÃ  gÃ¬?

Äiá»u cuá»‘i cÃ¹ng cá»§a **kernel** lÃ m trong quÃ¡ trÃ¬nh khá»Ÿi táº¡o cá»§a nÃ³ lÃ  báº¯t Ä‘áº§u "há»‡ thá»“ng **`init`**", thÃ´ng thÆ°á»ng lÃ  cháº¡y lá»‡nh **``/sbin/init``**.

CÃ³ ráº¥t nhiá»u há»‡ thá»‘ng **`init`** khÃ¡c nhau, nhÆ°ng chÃºng Ä‘iá»u giá»‘ng nhau nhá»¯ng thá»© sau Ä‘Ã¢y:

- Kiá»ƒm soÃ¡t **services** nÃ o báº¯t Ä‘áº§u khi khá»Ÿi Ä‘á»™ng
- Cung cáº¥p **tools** cho **services** khá»Ÿi cháº¡y, dá»«ng **services** vÃ  cho tá»•ng thá»ƒ thÃ´ng tin vá» tráº¡ng thÃ¡i **service**.
- Cung cáº¥p má»™t **framework** cho ghi **services** má»›i

"**service**" á»Ÿ Ä‘Ã¢y lÃ  bao gá»“m má»i thá»© tá»« **web server** Ä‘áº¿n **system-level servers** Ä‘Æ°á»£c sá»­ dá»¥ng quáº£n lÃ­ Ä‘Äƒng nháº­p.

Vá» cÆ¡ báº£n, viá»‡c cá»§a má»™t há»‡ thá»‘ng **`init`**Â lÃ  láº¥y táº¥t cáº£ chÆ°Æ¡ng trÃ¬nh **user-facing** (nhÆ° lÃ  non-kernel...) vÃ  **services** Ä‘ang cháº¡y.

Trong quÃ¡ khá»©, há»‡ thá»‘ng **init** phá»• biáº¿n Ä‘Æ°á»£c gá»i lÃ  "**System V init**", cÃ¡i tÃªn Ä‘Æ°á»£c Ä‘áº·t tá»« **UNIX System V**. Gáº§n Ä‘Ã¢y hÆ¡n trong **Linux**, **systemd init system** Ä‘Ã£ dáº§n á»Ÿ trÃªn phá»• biáº¿n hÆ¡n do áº£nh hÆ°á»Ÿng cÃ¡c **Linux distro** nhÆ° : **Cent OS, RedHat, Debian, Ubuntu** vÃ  má»™t sá»‘ khÃ¡c.

Do Ä‘Ã³ cÃ³ 2 Ä‘iá»u nÃªn ghi nhá»› vá» **Linux init system**:

1. KhÃ¡c báº£n phÃ¢n phá»‘i **Linux** cÃ³ thá»ƒ sá»­ dá»¥ng khÃ¡c **init systems**
2. KhÃ¡c phiÃªn báº£n cá»§a cÃ¹ng má»™t báº£n phÃ´i phá»‘i **Linux** cÃ³ thá»ƒ sá»­ dá»¥ng khÃ¡c **init systems**

**VÃ­ dá»¥:** **systemd** trá»Ÿ thÃ nh **init system** máº·c Ä‘á»‹nh trÃªn **Ubuntu** tá»« báº£n v15.04 (ra máº¯t vÃ o nÄƒm **2015**).

---

## 5. Dá»«ng tiáº¿n trÃ¬nh vá»›i **`kill`** vÃ  **`killall`**

ÄÃ´i lÃºc báº¡n muá»‘n **kill** má»™t tiáº¿n trÃ¬nh mÃ  nÃ³ tiÃªu hao quÃ¡ nhiá»u tÃ i nguyÃªn hoáº·c náº¿u khÃ´ng thÃ¬ nÃ³ khÃ´ng pháº£n há»“i. CÃ³ 2 **tool** phá»• biáº¿n trong viá»‡c nÃ y Ä‘Ã³ lÃ  **`kill`** vÃ  **`killall`**.

Lá»‡nh **`kill`** cáº§n cung cáº¥p má»™t **ID** tiáº¿n trÃ¬nh (hoáº·c **PID**), cÃ³ thá»ƒ tÃ¬m nÃ³ báº±ng cÃ¡ch sá»­ dá»¥ng lá»‡nh **`ps`**. Lá»‡nh **`killall`** cáº§n cung cáº¥p má»™t tÃªn cá»§a tiáº¿n trÃ¬nh, sau Ä‘Ã³ nÃ³ sáº½ cá»‘ gáº¯ng **kill** má»i tiáº¿n trÃ¬nh vá»›i tÃªn cá»§a tiáº¿n trÃ¬nh Ä‘Ã³.

Xem xÃ©t **vÃ­ dá»¥** sau báº±ng **`ps`**:

```shell
$ ps
    PID TTY            TIME CMD
20735   ttys000     0:00.10 -bash
 3086   ttys002     0:00.70 -bash
```

ChÃºng ta cÃ³ hai tiáº¿n trÃ¬nh **`bash`** Ä‘ang cháº¡y, tiáº¿n trÃ¬nh 1 vá»›i **`PID`** lÃ  *20735* vÃ  tiáº¿n trÃ¬nh 2 vá»›i **`PID`** lÃ  *3086*. HÃ£y cháº¡y lá»‡nh **`kill 3086`** thÃ¬ láº­p tá»©c há»‡ Ä‘iá»u nÃ y sáº½ gá»­i "*gracefull shutdown*" tÃ­n hiá»‡u Ä‘Ã³ cho tiáº¿n trÃ¬nh **bash** cá»¥ thá»ƒ trÃªn, khi cháº¡y lá»‡nh **`killall bash`** sáº½ gÃ¢y ra cho há»‡ Ä‘iá»u hÃ nh báº¯t buá»™c thoÃ¡t má»i tiáº¿n trÃ¬nh **`bash`**.

### Gá»­i tÃ­n hiá»‡u khÃ¡c nhau

Bá»Ÿi máº·c Ä‘á»‹nh, **`kill`** vÃ  **`killall`** sáº½ gá»­i tiáº¿n hiá»‡u **`TERM`** tá»›i tiáº¿n trÃ¬nh xÃ¡c Ä‘á»‹nh. TÃ­n hiá»‡u **`TERM`** lÃ  má»™t "*graceful*" tÃ­n hiá»ƒu báº¯t buá»™c thoÃ¡t.

**VÃ­ dá»¥:** Má»™t tiáº¿n trÃ¬nh cÃ³ thá»ƒ muá»‘n hoÃ n thÃ nh nÃ³ trÆ°á»›c khi báº¯t buá»™c thoÃ¡t hoáº·c clean up má»™t sá»‘ file táº¡m thá»i mÃ  nÃ³ cÃ²n sÃ³t láº¡i trÃªn há»‡ thá»‘ng.

Náº¿u má»™t quÃ¡ trÃ¬nh cÃ³ **bug** sáº½ khiáº¿n nÃ³ khÃ´ng pháº£n há»“i thÃ¬ nÃ³ khÃ´ng thá»ƒ xá»­ lÃ½ tÃ­n hiá»‡u **`TERM`**. Trong trÆ°á»ng há»£p Ä‘Ã³, báº¡n cÃ³ thá»ƒ gá»­i tÃ­nh hiá»‡u khÃ¡c nhÆ° lÃ  **`KILL`**.

CÃ³ 2 cÃ¡ch Ä‘á»ƒ lÃ m Ä‘iá»u Ä‘Ã³:

1. **`kill -KILL 3086`**, á»Ÿ Ä‘Ã¢y **`3086`** giáº£ Ä‘á»‹nh lÃ  ID tiáº¿n trÃ¬nh mÃ  báº¡n muá»‘n **kill**
2. **`kill -9 3086`**

Má»i tÃ­nh hiá»‡u sáº½ cho má»™t giÃ¡ trá»‹ sá»‘ vÃ  giÃ¡ trá»‹ Ä‘Ã³ cho **`KILL`** lÃ  **`9`**, nÃªn **`KILL`** vÃ  **`9`** lÃ  nhÆ° nhau.

Lá»‡nh **`kill -9`** vÃ  **`killall -9`** lÃ  hai lá»‡nh cá»±c ká»³ máº¡nh, nÃ³ tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i viá»‡c báº¡n táº¯t mÃ¡y tÃ­nh hoáº·c rÃºt dÃ¢y nguá»“n mÃ¡y tÃ­nh cá»§a báº¡n. Viá»‡c **kill** má»™t tiáº¿n trÃ¬nh cÃ³ thá»ƒ Ä‘á»ƒ láº¡i má»‘t má»› há»—n Ä‘á»™n, nhÆ°ng nÃ³ cÅ©ng cÃ³ cÃ¡ch duy nháº¥t Ä‘á»ƒ giáº£i quyáº¿t tÃ¬nh tráº¡ng khÃ´ng pháº£n há»“i

TÃ´i khuyÃªn báº¡n nÃªn lÃ  **luÃ´n luÃ´n** nÃªn dÃ¹ng dÃ¹ng lá»‡nh **kill PID** trÆ°á»›c khi Ä‘á»¥ng tá»›i lá»‡nh **`kill -9 PID`**

### TÃ¬m hiá»ƒu thÃªm

| ğŸŒÂ [TÃ­n hiá»‡u Kill](http://tldp.org/LDP/Bash-Beginners-Guide/html/sect_12_01.html) |
| --------------------------------------------------------------------------------- |

| [BÃ i 2.File streams](https://github.com/Zenfection/Linux-for-babies/blob/master/Jobs%20%26%20Processes%2C%20Data%20Manipulation/2.File%20Streams.md)Â ğŸ”œ |
| ------------------------------------------------------------------------------------------------------------------------------------------------------- |
