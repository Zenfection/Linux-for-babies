# File Streams

## 1. Lá»‡nh **`head`** vÃ  **`tail`**

**`head`** vÃ  **`tail`** lÃ  2 lá»‡nh cho phÃ©p báº¡n chá»n vÃ  hiá»ƒn thá»‹ má»™t Ã­t dÃ²ng Ä‘áº§u tiÃªn hoáº·c Ã­t dÃ²ng cuá»‘i cÃ¹ng tá»« má»™t **file** hoáº·c Ä‘áº§u ra **stream** tÆ°Æ¡ng á»©ng. Máº·c Ä‘á»‹nh thÃ¬ cáº£ hai sáº½ chá»n 10 dÃ²ng, nhÆ°ng sá»­ dá»¥ng tuá»³ chá»n **`-n`** báº¡n cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh sá»‘ báº¡n muá»‘n.

**`VÃ­ dá»¥:`** Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng lá»‡nh **`tail`** Ä‘á»ƒ chá»n 5 dÃ²ng cuá»‘i cá»§a má»™t **file** nhÆ° sau:

```shell
tail -n5 /Users/zenfection/Desktop/kiet.txt
```

![2020-08-15 23.45.46.gif](https://raw.githubusercontent.com/Zenfection/Image/master/2020/08/15-23-46-26-2020-08-15%2023.45.46.gif)

TÆ°Æ¡ng tá»± nhÆ° váº­y, Báº¡n cÃ³ thá»ƒ dÃ¹ng lá»‡nh **`head`** Ä‘á»ƒ chá»n vÃ  hiá»ƒn thá»‹ 5 dÃ²ng Ä‘áº§u nhÆ° sau:

```shell
head -n5 /Users/zenfection/Desktop/kiet.txt
```

![2020-08-15 23.47.47.gif](https://raw.githubusercontent.com/Zenfection/Image/master/2020/08/15-23-48-26-2020-08-15%2023.47.47.gif)

### Sá»­ dá»¥ng lá»‡nh **`tail -f`**

Ãp dá»¥ng tuá»³ chá»n **`-f`** (*follow*) Ä‘á»ƒ lá»‡nh **`tail`** sáº½ khÃ´ng dá»«ng Ä‘áº¿n khi Ä‘áº¡t tá»›i cuá»‘i **file**. HÃ£y thá»­ lá»‡nh sau Ä‘Ã¢y:

```shell
tail -f var/log/messages
```

Trong **Linux**, **``/var/log/messages``** lÃ  "*system log file*". NhÆ° lÃ  thÃªm má»¥c nháº­t kÃ½ má»›i vÃ o **file**, vÃ  lá»‡nh **`tail -f`** sáº½ hiá»ƒn thá»‹ chÃºng.

Äiá»u nÃ y nhÆ° báº¡n gá»i "*tailing a log file*" hoáº·c "*taling a file*"

### Sá»­ dá»¥ng **`head`** vÃ  **`tail`** vá»›i **`|`**

NÃ³ cÅ©ng phá»• biáº¿n sá»­ dá»¥ng **`head`** vÃ  **`tail`** Ä‘á»ƒ lá»c Ä‘áº§u ra cá»§a má»™t chÆ°Æ¡ng trÃ¬nh khÃ¡c, hÃ£y thá»­ lá»‡nh sau:

```shell
ls -t | head -n3
ls -t | tail -n3
```

Lá»‡nh **`ls -t`** sáº½ hiá»ƒn thá»‹ danh sÃ¡ch cá»§a ná»™i dung **directory** hiá»‡n táº¡i sáº¯p xáº¿p bá»Ÿi thá»i gian sá»­a Ä‘á»•i (*láº§n gáº§n Ä‘Ã¢y nháº¥t*). NÃªn lá»‡nh **`ls -t | head -n3`** sáº½ hiá»ƒn thá»‹ danh sÃ¡ch cá»§a  **3 files** gáº§n Ä‘Ã¢y nháº¥t, cÃ²n lá»‡nh **`ls -t | tail -n3`** sáº½ hiá»ƒn thá»‹ ra **3 files** cÅ© nháº¥t.

---

## 2. PhÃ¢n trang trong file lá»›n sá»­ dá»¥ng **`less`**

Lá»‡nh **`less`** cho phÃ©p báº¡n cuá»™n vÃ  tÃ¬m kiáº¿m thÃ´ng qua cÃ¡c **streams** cá»§a Ä‘áº§u ra má»™t file ráº¥t lá»›n

**VÃ­ dá»¥ nhÆ° sau:**

```shell
ps aux | less
```

**`ps aux`** sáº½ in chi tiáº¿t thÃ´ng tin vá» tiáº¿n trÃ¬nh hiá»‡n táº¡i Ä‘ang cháº¡y vÃ  cÃ³ thá»ƒ chiáº¿m nhiá»u mÃ n hÃ¬nh hiá»ƒn thá»‹ cÃ³ vÄƒn báº£n. Báº±ng cÃ¡ch Ä‘Æ°a Ä‘áº§u ra nÃ³ Ã­t hÆ¡n báº±ng **`less`** chÃºng ta cÃ³ thá»ƒ cuá»™n Ä‘á»ƒ xem thÃ´ng tin dá»… hÆ¡n.

Sá»­ dá»¥ng **key** mÅ©i tÃªn trÃªn mÃ n hÃ¬nh Ä‘á»ƒ kÃ©o lÃªn, xuá»‘ng, trÃ¡i, pháº£i cho mÃ n hÃ¬nh hiá»ƒn thá»‹. Nháº¥n Ä‘á»ƒ phÃ­m **spacebar** sáº½ cuá»™n vá» trÆ°á»›c trong khi nháº¥n giá»¯ phÃ­m **`b`** sáº½ cuá»™n vá» sau.

Äá»ƒ thoÃ¡t **`less`** hÃ£y sá»­ dá»¥ng phÃ­m **`q`**.

### TÃ¬m kiáº¿m báº±ng **`less`**

**`less`** cÅ©ng cÃ³ kháº£ nÄƒng tÃ¬m kiáº¿m thÃ´ng qua Ä‘áº§u ra. Äá»ƒ tÃ¬m kiáº¿m hÃ£y nháº¥n giá»¯ phÃ­m **`/`** vÃ  **enter** Ä‘á»ƒ báº­t cháº¿ Ä‘á»™ **search**, nháº­p tá»« khoÃ¡ hoáº·c máº«u báº¡n muá»‘n tÃ¬m kiáº¿m. **`less`** sáº½ cho báº¡n máº«u Ä‘áº§u tiÃªn mÃ  nÃ³ tÃ¬m Ä‘Æ°á»£c, Náº¿u báº¡n muá»‘n qua kÃ½ tá»± tiáº¿p theo nÃ³ tÃ¬m Ä‘Æ°á»£c, hÃ£y gÃµ phÃ­m **`?`**

Má»™t sá»‘ **Ä‘iá»u hÆ°á»›ng** trong phá»• biáº¿n:

- Äá»ƒ xem lÃ¹i vá» phÃ­a trÆ°á»›c
  - Nháº¥n **`n`**
  - gÃµ **`/`** vÃ  nháº¥n **enter**
- Äá»ƒ xem tiáº¿p theo phÃ­a sau
  - nháº¥n **`N`**
  - gÃµ **`?`**  vÃ  nháº¥n **enter**

### Tiá»n nhiá»‡m cá»§a **`less`**

Theo cÃ¹ng má»™t cÃ¡ch ráº±ng **`bash`** (*the Bourne Again Shell*) dá»±a trÃªn tiá»n nhiá»‡m cá»§a nÃ³ lÃ  **`sh`** (*the Bourne Shell*), **`less`** dá»±a trÃªn tiá»n nhiá»‡m cá»§a nÃ³ lÃ  **`more`**. Lá»‡nh **`more`** tá»“n táº¡i trong háº§u háº¿t cÃ¡c há»‡ thá»‘ng nhÆ°ng nÃ³ cÃ³ nhiá»u giá»›i háº¡n hÆ¡n lá»‡nh **`less`**.

**VÃ­ dá»¥:** Vá»›i lá»‡nh **`more`** sáº½ khÃ´ng thá»ƒ cuá»™n vá» sau

### Äá»c hÆ°á»›ng dáº«n

HÃ£y cháº¡y lá»‡nh **`man less`** Ä‘á»ƒ Ä‘á»c hÆ°á»›ng dáº«n vÃ  cÃ¡ch sá»­ dá»¥ng **`less`**

### TÃ¬m hiá»ƒu thÃªm

| ğŸŒ [So sÃ¡nh mÃ¡y tin nháº¯n](http://unix.stackexchange.com/questions/81129/what-are-the-differences-between-most-more-and-less) | ğŸ“ [HÆ°á»›ng dáº«n sá»­ dá»¥ng less](http://man7.org/linux/man-pages/man1/less.1.html) |
| ---------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------- |

---

## 3. Chá»n pháº§n cá»§a má»™t dÃ²ng sá»­ dá»¥ng **`cut`**

Lá»‡nh **`cut`** cho phÃ©p chÃºng ta (*cut out*) xÃ¡c Ä‘á»‹nh pháº§n cá»§a má»—i dÃ²ng trong **file**. Báº¡n cÃ³ thá»ƒ vÆ°á»£t qua tÃªn cá»§a má»™t **file** Ä‘á»ƒ **`cut`** trá»±c tiáº¿p hoáº·c qua Ä‘áº§u ra cá»§a nÃ³ tá»« má»™t chÆ°Æ¡ng trÃ¬nh khÃ¡c thÃ´ng qua toÃ¡n tá»­ **`|`**

ÄÃ¢y lÃ  má»™t sá»‘ **vÃ­ dá»¥ cÆ¡ báº£n**:

### Cáº¯t kÃ½ tá»±

Tuá»³ chá»n **`-c`** gá»i **`cut`** Ä‘á»ƒ chá»n kÃ½ tá»± tá»« Ä‘áº§u vÃ o:

```shell
$ echo "one:two:three" | cut -c2
n
$ echo "one:two:three" | cut -c1-5
one:t
```

Trong trÆ°á»ng há»£p nÃ y, **`-c2`** gá»i lá»‡nh **`cut`** chá»n kÃ½ tá»± thá»© 2 trong khi **`-c1-5`** gá»i lá»‡nh **`cut`** chá»n Ä‘á»™ dÃ i cá»§a kÃ½ tá»±  (tá»« kÃ½ tá»± thá»© 1 Ä‘áº¿n thá»© 5).

NÃ³ cÅ©ng cÃ³ thá»ƒ chá»n xÃ¡c Ä‘á»‹nh kÃ½ tá»± báº±ng cÃ¡ch sá»­ dá»¥ng **`,`** thay vÃ¬ **`-`**.

**VÃ­ dá»¥:** **`-c1,3,5`** tá»©c lÃ  chá»n kÃ½ tá»± thá»© 1,3 vÃ  5 má»—i dÃ²ng cá»§a Ä‘áº§u vÃ o 

### Cáº¯t theo vÃ¹ng

ChÃºng ta cÃ³ thá»ƒ cáº¯t ra cá»™t hoáº·c vÃ¹ng, xem **vÃ­ dá»¥ sau:**

```shell
$ echo "one:two:three" | cut -d":" -f1
one
$ echo "one:two:three" | cut -d":" -f2
two 
$ echo "one:two:three" | cut -d":" -f1-2
```

Tuá»³ chá»n **`-d":"`** tá»©c lÃ  xem xÃ©t Ä‘áº§u vÃ o Ä‘Æ°á»£c ngÄƒn tÃ¡ch bá»Ÿi kÃ½ tá»± **`:`**.  **`-f1`** tá»©c lÃ  chá»n vÃ¹ng Ä‘áº§u tiÃªn (ngÄƒn cÃ¡ch bá»Ÿi dáº¥u **`:`** ) vÃ  **`-f1-2`** tá»©c lÃ  chá»n vÃ¹ng thá»© 1 vÃ  thá»© 2.

NÃ³ cÃ³ thá»ƒ sá»­ dá»¥ng **`-f`** mÃ  khÃ´ng cáº§n **`-d`**, máº·c dÃ¹ máº·c Ä‘á»‹nh thÃ¬ **`cut`** giáº£ Ä‘á»‹nh ráº±ng Ä‘áº§u vÃ o cá»§a vÃ¹ng Ä‘Æ°á»£c giá»›i háº¡n bá»Ÿi kÃ½ tá»± **`tab`**.

### VÃ­ dá»¥ thá»±c táº¿

**file** **``/etc/passwd``** chá»©a thÃ´ng tin vá» má»i ngÆ°á»i dÃ¹ng trÃªn há»‡ thá»‘ng, bao gá»“m **usernames** vÃ  **home directory**. Äá»‹nh dáº¡ng ráº¥t lÃ  chuáº©n. HÃ£y theo dÃµi vÃ­ dá»¥ sau Ä‘Ã¢y sáº½ in ra má»i ngÆ°á»i dÃ¹ng vá»›i **home directory** cá»§a há» trÃªn há»‡ thá»‘ng:

```shell
$ cut -d":" -f1,6 /etc/passwd
```

![2020-08-16 14.12.22.gif](https://raw.githubusercontent.com/Zenfection/Image/master/2020/08/16-14-14-00-2020-08-16%2014.12.22.gif)

VÃ¹ng cá»§a **``/etc/passwd``** Ä‘Æ°á»£c ngÄƒn cÃ¡ch bá»Ÿi **`:`** vá»›i vÃ¹ng Ä‘áº§u tiÃªn chá»©a **username** vÃ  vÃ¹ng thá»© 2 chá»©a **home directory** cá»§a ngÆ°á»i dÃ¹ng.

---

## 4. Chuyá»ƒn Ä‘á»•i vÄƒn báº£n vá»›i **`sed`**

Lá»‡nh **`sed`** (gá»i táº¯t lÃ  *stream editor*) Ä‘Æ°á»£c sá»­ dá»¥ng váº­n dá»¥ng má»™t **stream** cá»§a vÄƒn báº£n má»™t dÃ²ng trong má»™t thá»i gian. ThÆ°á»ng sá»­ dá»¥ng trong trÆ°á»ng há»£p thay Ä‘á»•i ná»™i dung cá»§a má»™t file hoáº·c Ä‘áº§u ra cá»§a má»™t chÆ°Æ¡ng trÃ¬nh khÃ¡c trong 1 thá»i gian.

Äá»ƒ sá»­ dá»¥ng Ã­t háº¿t tÃ­nh nÄƒng, báº¡n hÃ£y hiá»ƒu má»™t chÃºt vá» biá»ƒu hiá»‡n thÃ´ng thÆ°á»ng, nhÆ°ng thay vÃ¬ giáº£i thÃ­ch, tÃ´i sáº½ cho báº¡n má»™t sá»‘ vÃ­ dá»¥ há»¯u Ã­ch sau Ä‘Ã¢y.

ChÃºng ta sáº½ giáº£ Ä‘á»‹nh ráº±ng cÃ³ má»™t **file** tÃªn lÃ  **`data.txt`** nÃ³ chá»©a ná»™i dá»¥ng, chÃºng ta quan tÃ¢m tá»›i viá»‡c sá»­a Ä‘á»•i nÃ³ vá»›i nhiá»u cÃ¡ch khÃ¡c nhau. **`sed`** sáº½ Ä‘á»c ná»™i dung cá»§a **file** Ä‘Ã³, sá»­a Ä‘á»•i ná»™i dung theo hÆ°á»›ng mÃ  chÃºng ta quy Ä‘á»‹nh vÃ  in ra ná»™i dung Ä‘Ã£ Ä‘Æ°á»£c sá»­a Ä‘á»•i.

Náº¿u chÃºng ta muá»‘n lÆ°u Ä‘áº§u ra cá»§a nÃ³ ra má»™t **file**. HÃ£y sá»­ dá»¥ng dáº¥u **`>`**.

Â Â Â Â **1. Thay tháº¿ Ä‘oáº¡n text Ä‘Æ¡n giáº£n**

Â Â Â Â Â Â Â Â NÃ³ sáº½ thay tháº¿ má»i tá»« **`apples`** thÃ nh **`bananas`** trong **file** **`data.txt`**

```shell
sed 's/apples/bananas/g' data.txt
```

Äá»‹nh dáº¡ng chung cho "*tÃ¬m vÃ  thay tháº¿*" lÃ  **``s/stuff-to-find/stuff-to-replace/flags``**. **`flags`** cho phÃ©p chÃºng ta xÃ¡c Ä‘á»‹nh cháº¿ Ä‘á»™ khÃ¡c nhau cho lá»‡nh *tÃ¬m vÃ  thay tháº¿*.

**`/g`** gá»i lá»‡nh **`sed`** thay tháº¿ má»i trÆ°á»ng há»£p chá»©a **`apples`** thÃ nh **`bananas`**. Náº¿u khÃ´ng cÃ³ **`/g`** thÃ¬ **`sed`** chá»‰ thay tháº¿ trÆ°á»ng há»£p Ä‘áº§u tiÃªn thÃ´i.

Â Â Â Â **2.Thay tháº¿ vÄƒn báº£n nÃ¢ng cao**

Â Â Â Â Â Â Â Â NÃ³ sáº½ xoÃ¡ báº¥t ká»³ khoáº£ng tráº¯ng dÆ° thá»«a má»—i dÃ²ng hoáº·c tab dÆ° thá»«a nÃ o Ä‘áº¿n cuá»‘i dÃ²ng.

```shell
sed 's/[ \t]*$//' data.txt
```

Â Â Â Â Â Â Â Â ChÃºng ta sáº½ khÃ´ng Ä‘i sÃ¢u vÃ o cÃº phÃ¡p nÃ y, nhÆ°ng **`[ \t]*$`** lÃ  má»™t *regular-expression-ese* Ä‘áº¡i diá»‡n cho "*khÃ´ng hoáº·c nhiá»u khoáº£ng tráº¯ng hoáº·c tab nÃ o tá»›i cuá»‘i dÃ²ng*".

Â Â Â Â Â Â Â Â CÅ©ng tÆ°Æ¡ng tá»± nhÆ° tháº¿, nÃ³ sáº½ xoÃ¡ bá» báº¥t ká»³ khoáº£ng tráº¯ng dÆ° thá»«a hÃ ng Ä‘áº§u cá»§a má»—i **file**, cÄƒn chá»‰nh táº¥t cáº£ vÄƒn báº£n sang trÃ¡i:

```shell
sed 's/^[ \t]*//' data.txt
```

Â Â Â Â Â Â Â Â á» Ä‘Ã¢y thÃ¬ **`^[ \t]*`** lÃ  *regular-expression-ese* Ä‘áº¡i diá»‡n cho "*báº¯t Ä‘áº§u cá»§a má»™t dÃ²ng bá»Ÿi khÃ´ng hoáº·c nhiá»u kÃ½ tá»± space vÃ  tab*"

NhÆ° báº¡n Ä‘Ã£ tháº¥y Ä‘Ã³, **`sed`** cung cáº¥p má»™t cÃ´ng cá»¥ máº¡nh Ä‘á»ƒ lÃ m viá»‡c vá»›i vÄƒn báº£n. NÃ³ lÃ  má»™t trong nhá»¯ng cÃ´ng cá»¥ phá»• biáº¿n nháº¥t náº¿u báº¡n muá»‘n chuyá»ƒn Ä‘á»•i Ä‘áº§u ra cá»§a má»™t chÆ°Æ¡ng trÃ¬nh hoáº·c ná»™i dung cá»§a má»™t **file** theo má»™t sá»‘ quy Ä‘á»‹nh báº¡n Ä‘áº·t ra. 

### TÃ¬m hiá»ƒu thÃªm

| ğŸŒÂ [CÃ¡ch váº­n dá»¥ng lá»‡nh `sed`](http://sed.sourceforge.net/sed1line.txt) |
| ---------------------------------------------------------------------- |

---

## 5. NgÃ´n ngá»¯ láº­p trÃ¬nh **`AWK`** vÃ  lá»‡nh **`awk`**

**`AWK`** lÃ  má»™t ngÃ´n ngá»¯ láº­p trÃ¬nh cho xá»© lÃ½ **files** vÄƒn báº£n. NÃ³ xem **files** vÄƒn báº£n nhÆ° má»™t báº£ng lá»›n cá»§a dá»¯ liá»‡u nÆ¡i mÃ  dÃ²ng lÃ  báº£n ghi cÃ²n cá»™t lÃ  **fields**. Máº·c Ä‘á»‹nh thÃ¬ **`AWK`** sáº½ coi má»—i dÃ²ng nhÆ° má»™t **record** cÃ²n má»—i tá»« trong dÃ²ng nhÆ° má»™t **fields**, máº·c dÃ¹ nÃ³ cÃ³ thá»ƒ thay Ä‘á»•i.

NÃ³ Ä‘Æ°á»£c Ä‘áº·t tÃªn báº±ng cÃ¡ch viáº¿t táº¯t cÃ¡c chá»¯ cÃ¡i Ä‘áº§u tiÃªn cá»§a cÃ¡c tÃ¡c giáº£: **Aho, Weinberger vÃ  Kernighan.**

ThÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng cho viá»‡c tÃ¬m kiáº¿m vÃ  xá»­ lÃ½ text. NÃ³ sáº½ tÃ¬m kiáº¿m má»™t hoáº·c nhiá»u file Ä‘á»ƒ xem xem trong cÃ¡c file Ä‘Ã³ cÃ³ dÃ²ng nÃ o bao gá»“m nhá»¯ngÂ `pattern`Â (khuÃ´n máº«u) cho trÆ°á»›c hay khÃ´ng, sau Ä‘Ã³ thá»±c hiá»‡n nhá»¯ngÂ `action`Â (hÃ nh Ä‘á»™ng) tÆ°Æ¡ng á»©ng.

Lá»‡nh **`awk`** lÃ  má»™t cÃ´ng cá»¥ phá»• biáº¿n dÃ¹ng Ä‘á»ƒ hiá»ƒn thá»‹ hoáº·c chuyá»ƒn Ä‘á»•i dá»¯ liá»‡u **text**. Äá»ƒ minh hoáº¡ cho **`awk`**, cÃ³ ráº¥t nhiá»u cÃ¡c chÆ°Æ¡ng trÃ¬nh thao tÃ¡c vá»›i má»¥c Ä‘Ã­ch Ä‘áº·c biá»‡t nhÆ° **`head`**, **`tail`**, **`sed`** vÃ  **`cut`** cÃ³ thá»ƒ Ä‘Æ°á»£c triá»ƒn khai dÆ°á»›i dáº¡ng má»™t **script AMK** nhá».

### Hiá»ƒn thá»‹ cá»™t cá»¥ thá»ƒ

Chá»n vÃ  Ä‘á»‹nh dáº¡ng cá»™t cá»¥ thá»ƒ cá»§a **text** cÃ³ láº½ lÃ  háº§u háº¿t sá»­ dá»¥ng cá»§a **`awk`**.

**VÃ­ dá»¥:** NÃ³ sáº½ in ra **fields** thá»© 1 vÃ  thá»©  6 tá»« file **``/etc/passwd``** :

```shell
awk -F':' '{print $1,$6}' /etc/passwd
```

![2020-08-16 14.50.08.gif](https://raw.githubusercontent.com/Zenfection/Image/master/2020/08/16-14-52-35-2020-08-16%2014.50.08.gif)

### TÃ¬m hiá»ƒu thÃªm

| ğŸŒÂ [CÃ¡ch sá»­ dá»¥ng AWK](http://www.pement.org/awk/awk1line.txt) |
| ------------------------------------------------------------- |

| ğŸ”™Â [BÃ i 1.Ná»n táº£ng cá»§a quáº£n lÃ­ tiáº¿n trÃ¬nh](https://github.com/Zenfection/Linux-for-babies/blob/master/Jobs%20%26%20Processes%2C%20Data%20Manipulation/1.Basics%20of%20process%20management.md) | [BÃ i 3.Grep vÃ  tÃ¡c vá»¥ ná»n](https://github.com/Zenfection/Linux-for-babies/blob/master/Jobs%20%26%20Processes%2C%20Data%20Manipulation/3.Grep%26Background%20tasks.md)Â ğŸ”œ |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
